# 李林汐演员资料展示网站

## 项目简介
这是一个专为童星演员李林汐设计的个人资料展示网站，采用响应式设计，重点优化移动端体验。

## 技术栈
- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **部署**: Vercel
- **视频格式**: MP4 (H.264编码)

## 项目结构
```
CICI网页版/
├── index.html              # 主页面
├── style.css               # 样式文件
├── script.js               # 交互逻辑
├── videos/                 # 视频资源文件夹
│   ├── intro.mp4           # 自我介绍视频 (16:9)
│   ├── work1.mp4           # 影视作品视频 (16:9)
│   ├── work2.mp4           # 短剧作品1 (竖屏)
│   ├── work3.mp4           # 短剧作品2 (竖屏)
│   ├── ...                 # work4-work14.mp4
│   └── README.md           # 视频文件说明
├── pictures/               # 图片资源文件夹
│   ├── 模卡1.jpg           # 模卡横屏图片
│   ├── 模卡2.jpg           # 模卡竖屏图片
│   ├── 模卡3.jpg           # 模卡竖屏图片
│   ├── 古风1.jpg           # 古风造型图片
│   ├── 古风2.jpg           # 古风造型图片
│   ├── ...                 # 古风3-8.jpg
│   ├── 数据1.jpg           # 数据展示图片
│   ├── 数据2.jpg           # 数据展示图片
│   ├── 数据3.jpg           # 数据展示图片
│   └── 数据4.jpg           # 数据展示图片
├── assets/images/          # 头像等资源
│   ├── avatar.jpg          # 头像图片
│   └── README.md           # 图片文件说明
└── README.md               # 项目说明
```

## 功能特性

### 🎭 出演经历展示
- **影视经历区域**: 详细展示院线电影、电视剧、网剧等作品信息
- **短剧经历区域**: 文本形式整齐排列展示短剧作品，包含作品名称和主演信息
- **作品信息**: 包含作品名称、角色、导演、主演等详细信息

### 🖼️ 图片展示
- **模卡区域**: 横屏模卡图片独占一行显示
- **古风造型区域**: 竖屏模卡图片两列网格布局，正方形显示
- **部分数据区域**: 数据图片三列网格布局，正方形显示
- **全屏查看**: 所有图片支持点击全屏查看功能

### 🎬 视频展示
- **自我介绍区域**: 横屏16:9视频，单独一排显示
- **影视作品区域**: 横屏16:9视频，单独一排显示  
- **短剧作品区域**: 竖屏视频网格，一行三个正方形排列
- **横屏视频区域**: 新增横屏视频单独显示
- **空位处理**: 竖屏视频网格最后位置留空，无UI显示

### 📱 响应式设计
- **移动端优先**: 针对手机端优化
- **平板适配**: 768px+ 断点优化
- **桌面端**: 1024px+ 最大宽度限制

### 🎮 交互功能
- **全屏播放**: 点击视频全屏播放
- **图片全屏**: 点击图片全屏查看
- **加载状态**: 视频加载时显示提示
- **错误处理**: 视频加载失败时显示错误信息，关闭时不再显示错误提示
- **触摸反馈**: 移动端触摸交互优化
- **键盘支持**: ESC键关闭全屏模态框
- **背景点击**: 点击模态框背景关闭全屏
- **返回键处理**: 全屏时点击返回键只退出全屏，不退出网页
- **微信浏览器兼容**: 专门优化微信内置浏览器的返回键处理
- **稳定拦截**: 使用 History API 实现稳定的返回键拦截机制
- **状态管理**: 智能的全屏状态管理和事件监听器控制

### 🎨 设计风格
- **色彩方案**: 柔和温馨的粉色渐变
- **字体**: 系统无衬线字体，清晰易读
- **动画**: 流畅的悬停和点击效果
- **布局**: 合理的留白和层次分明

## 部署说明

### Vercel 部署
1. 将项目文件上传到 GitHub 仓库
2. 在 Vercel 中导入项目
3. 确保所有视频文件已上传
4. 确保所有图片文件已上传
5. 部署完成后测试功能

### 文件要求
- 所有视频文件必须放在 `videos/` 文件夹中
- 所有图片文件必须放在 `pictures/` 文件夹中
- 视频格式: MP4 (H.264编码)
- 图片格式: JPG
- 文件大小: 建议单个视频不超过50MB，单个图片不超过10MB

### 当前视频存储配置（混合方案）

#### 配置概述

**🎯 混合存储策略**：
- **前两个视频**（自我介绍、影视作品）：使用 **阿里云VOD** 服务
- **其余视频**（短剧作品）：使用 **阿里云OSS** 存储
- **封面策略**：全部留空，使用浏览器自动生成的首帧封面
- **预加载模式**：所有视频使用 `preload="metadata"`

#### VOD 配置（前两个视频）

**优势**：
- ✅ **集成CDN加速**：全球CDN节点，访问速度快
- ✅ **视频优化**：自动转码和多格式支持
- ✅ **播放体验**：首帧加载快，播放流畅
- ✅ **移动端优化**：专门针对移动设备优化

**当前配置**：
```html
<!-- 自我介绍视频 -->
<video 
    class="video-player" 
    preload="metadata"
    muted
    poster=""
    data-src="https://outin-b8482c64a38911f0b71c00163e32360c.oss-cn-shanghai.aliyuncs.com/sv/3889f2c3-199bf1777c8/3889f2c3-199bf1777c8.mp4">

<!-- 影视作品视频 -->
<video 
    class="video-player" 
    preload="metadata"
    muted
    poster=""
    data-src="https://outin-b8482c64a38911f0b71c00163e32360c.oss-cn-shanghai.aliyuncs.com/sv/3c7e1ec4-199bf166f91/3c7e1ec4-199bf166f91.mp4">
```

#### OSS 配置（短剧作品）

**配置要求**：
- **存储桶权限**：必须设置为"公共读"
- **MIME类型**：确保 `.mp4` 返回 `video/mp4`
- **CORS设置**：允许 GET/HEAD，来源 `*`，Headers `*`

**当前配置**：
```html
<!-- 短剧作品视频 -->
<video 
    class="video-player" 
    preload="metadata"
    muted
    poster=""
    data-src="videos/work2.mp4">
```

#### 封面策略

**统一配置**：
- 所有视频的 `poster` 属性都设置为空：`poster=""`
- 浏览器会自动使用视频的第一帧作为封面
- 无需手动准备封面图片，减少维护工作

#### 预加载策略

**`preload="metadata"` 的优势**：
- ✅ **预加载元数据**：视频时长、尺寸等信息
- ✅ **显示首帧**：自动显示视频第一帧作为封面
- ✅ **适中加载量**：只加载元数据，不影响页面加载速度
- ✅ **更好体验**：用户可以看到视频时长和预览

#### 故障排查

**常见问题及解决方案**：

1. **VOD视频无法播放**：
   - 检查VOD服务是否正常
   - 确认视频文件是否存在于VOD中
   - 检查网络连接和CDN状态

2. **OSS视频无法播放**：
   - 检查OSS存储桶权限是否为"公共读"
   - 检查CORS配置是否正确
   - 检查MIME类型是否为 `video/mp4`

3. **封面不显示**：
   - 确认 `poster=""` 设置正确
   - 检查浏览器是否支持自动首帧生成
   - 确保视频文件可以正常加载元数据

4. **播放卡顿**：
   - VOD视频：检查CDN节点状态
   - OSS视频：考虑配置CDN加速
   - 检查网络环境和设备性能

#### 性能对比

| 视频类型 | 存储方式 | 首帧时间 | 播放流畅度 | 全球访问 |
|----------|----------|----------|------------|----------|
| 自我介绍 | VOD | < 1秒 | 优秀 | 优秀 |
| 影视作品 | VOD | < 1秒 | 优秀 | 优秀 |
| 短剧作品 | OSS | 1-3秒 | 良好 | 一般 |

#### 优化建议

**短期优化**：
- 为OSS视频配置CDN加速
- 优化视频文件大小和格式

**长期优化**：
- 考虑将所有视频迁移到VOD
- 统一使用VOD获得最佳用户体验

## 浏览器兼容性
- ✅ Chrome (推荐)
- ✅ Safari (iOS/ macOS)
- ✅ Firefox
- ✅ Edge
- ✅ 微信内置浏览器 (专门优化)

### 微信浏览器特殊说明
针对微信浏览器的返回键限制，我们采用稳定的解决方案：

1. **History API 拦截**: 使用 `history.pushState` 添加历史记录，监听 `popstate` 事件
2. **智能状态管理**: 通过 `enableBackButtonHandler/disableBackButtonHandler` 控制拦截状态
3. **微信环境检测**: 支持 `WeixinJSBridge` 检测，提供微信特定处理
4. **多重保护机制**: 结合 `event.preventDefault()` 和重新添加历史记录

#### 返回键处理流程
```
进入全屏 → enableBackButtonHandler() → 添加历史记录 → 监听 popstate
按返回键 → 触发 popstate → 检查全屏状态 → 关闭全屏 → 阻止默认行为
退出全屏 → disableBackButtonHandler() → 移除监听器 → 清理状态
```

## 性能优化
- 视频预加载元数据
- 图片懒加载（支持 IntersectionObserver 降级）
- CSS动画硬件加速
- 响应式图片
- 代码分割和压缩
- 图片全屏查看优化
- 移动端触摸优化
- 微信浏览器特殊优化
- 页面可见性处理（隐藏时自动关闭全屏）
- Promise 异步视频播放控制

### 移动端（微信/X5）视频加载优化

- **视频标签属性**: 为所有 `<video>` 自动补齐以下属性，提升移动端兼容性：
  - `playsinline`, `webkit-playsinline`, `x5-playsinline`, `x5-video-player-type="h5"`, `x5-video-orientation="portrait"`
  - 默认 `preload="metadata"`
- **懒加载同步**: 懒加载时不仅设置 `<video src>`，也会同步更新子级 `<source src>`，确保部分浏览器的兼容性（尤其 X5/微信内核）。
- **加载兜底**:
  - 8 秒加载超时自动重试，最多 2 次；
  - 失败重试时附加时间戳参数 `_v` 强制刷新缓存；
  - 若视频静音（muted），在重试后主动触发一次 `play()` 以拉起加载；
  - `loadstart/loadeddata/error` 事件协同：启动/清理超时与触发重试。
- **可见性处理**: 页面隐藏时自动暂停/退出全屏，避免后台占用与加载异常。

上述逻辑位于 `script.js`：
- `setupVideoEvents()`：批量补齐属性并挂载兜底
- `loadVideoLazily()`：同步 `<video>` 与 `<source>` 的 `src`
- `attachMobileVideoGuards()`：实现超时与重试

## 开发说明

### 本地开发
1. 克隆项目到本地
2. 使用本地服务器运行 (推荐使用 Live Server)
3. 确保视频文件路径正确
4. 确保图片文件路径正确
5. 测试各设备兼容性

### 自定义配置
- 修改 `style.css` 调整样式
- 修改 `script.js` 调整交互逻辑
- 更新 `index.html` 修改内容结构

### 返回键处理技术细节

#### 核心函数
- `enableBackButtonHandler()`: 启用返回键拦截
- `disableBackButtonHandler()`: 禁用返回键拦截
- `setupWechatHandlers()`: 微信环境特殊处理

#### 关键变量
- `backButtonHandler`: 返回键事件处理函数
- `isBackButtonEnabled`: 返回键拦截状态标志
- `historyStateAdded`: 历史记录添加状态标志

#### 处理机制
1. **进入全屏时**:
   - 调用 `enableBackButtonHandler()`
   - 使用 `history.pushState()` 添加历史记录
   - 监听 `popstate` 事件

2. **按返回键时**:
   - 触发 `popstate` 事件
   - 检查全屏状态（视频/图片）
   - 关闭对应的全屏模态框
   - 调用 `event.preventDefault()` 阻止默认行为
   - 重新添加历史记录保持页面状态

3. **退出全屏时**:
   - 调用 `disableBackButtonHandler()`
   - 移除 `popstate` 事件监听器
   - 清理相关状态变量

#### 微信浏览器特殊处理
- 检测 `WeixinJSBridge` 环境
- 使用 `WeixinJSBridgeReady` 事件
- 提供微信特定的返回键处理逻辑

## 更新日志

### v3.2.0 (2025-01)
- ✅ 重构返回键处理逻辑，实现稳定的全屏返回键拦截
- ✅ 优化全屏状态管理，使用 enableBackButtonHandler/disableBackButtonHandler
- ✅ 增强微信浏览器兼容性，支持 WeixinJSBridge 检测
- ✅ 完善错误处理和调试日志系统
- ✅ 优化懒加载机制，支持 IntersectionObserver 降级
- ✅ 改进页面可见性处理，隐藏时自动关闭全屏
- ✅ 增强视频播放控制，支持 Promise 异步处理
- ✅ 完善图片全屏功能，优化事件监听器管理

### v3.0.0 (2025-01)
- ✅ 短剧经历改为文本形式整齐排列，移除预览框
- ✅ 新增模卡板块（横屏模卡1.jpg独占一行）
- ✅ 新增古风造型板块（模卡2.jpg和模卡3.jpg竖屏，一行两个，正方形，点击全屏）
- ✅ 短剧作品新增两个竖屏视频（work11.mp4、work12.mp4），一行三个，最后留空
- ✅ 短剧作品新增两个横屏视频（work13.mp4、work14.mp4），分别独占一行
- ✅ 新增部分数据板块（数据1-4.jpg，一行三个，正方形，点击全屏）
- ✅ 调整主体宽度，增加10px
- ✅ 完善所有UI对齐和留白
- ✅ 新增图片全屏查看功能
- ✅ 优化移动端响应式布局

### v2.0.0 (2025-01)
- ✅ 新增出演经历板块
- ✅ 影视经历详细展示（院线电影、电视剧、网剧等）
- ✅ 短剧经历网格布局（一行三个正方形预览）
- ✅ 修复全屏视频关闭时的错误提示问题
- ✅ 优化移动端响应式布局
- ✅ 完善作品信息展示格式

### v1.0.0 (2024-09)
- ✅ 基础页面结构
- ✅ 响应式视频布局
- ✅ 全屏播放功能
- ✅ 移动端优化
- ✅ 加载状态和错误处理

## 联系方式
- 项目维护: 开发团队
- 更新时间: 2025年1月
- 欢迎合作: 请联系相关方

## 许可证
本项目仅供展示使用，请勿用于商业用途。
#   c i c i 
 
 